<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.core.system.dao.UserRoleMapper" >
  
    <resultMap id="BaseResultMap" type="com.core.system.model.User">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Jul 21 16:19:05 CST 2013.
    -->
    <id column="user_id" jdbcType="INTEGER" property="userId" /> 
    <result column="user_name" jdbcType="VARCHAR" property="userName" />
  </resultMap>
  
	<select id="getRolesForUserById"  parameterType="int" resultType="com.core.system.model.Role">
		SELECT r.role_id as 'roleId',r.name,r.description,r.parent_id as 'parentId' 
		FROM t_security_role r,t_security_user_role ur
		WHERE r.role_id=ur.role_id AND ur.user_id=#{id}
	</select>
	
	<select id="getUsersForRoleById"  parameterType="int" resultMap="BaseResultMap">
		SELECT  u.user_id,u.user_name
		FROM t_security_user u , t_security_user_role ur , t_security_role r
		WHERE r.role_id = #{id} AND ur.role_id=r.role_id  AND  u.user_id=ur.user_id
	</select>
	
	<insert id="insert" parameterType="com.core.system.model.UserRole">
	    INSERT INTO t_security_user_role (user_id,role_id) values (#{userId},#{roleId}) 
	 </insert>
	 
	 <select id="getRoleIdsForUser" parameterType="int" resultType="String">
	   SELECT role_id FROM t_security_user_role WHERE user_id = #{id}
	 </select>
	 
	 <select id="getNumOfUsersForRole" parameterType="int" resultType="int">
	   SELECT COUNT(*) FROM t_security_user_role WHERE role_id = #{id}
	 </select>
	 
	 <delete id="deleteByUserId" parameterType="int">
	    DELETE FROM t_security_user_role WHERE user_id = #{id}
	 </delete>
	 
	 <delete id="deleteByRoleId" parameterType="int">
	    DELETE FROM t_security_user_role WHERE role_id = #{id}
	 </delete>
</mapper>